<template id="am2-wallet-template">
  <style>:host {
  display: flex;
  flex-wrap: wrap;
}
::slotted(wallet-panel) {
  flex-basis: 100%;
}</style>
  <h2><span class="am2-wallet-title"></span></h2>
  <div class="am2-wallet-transactions"></div>
</template>
<script>(function () {
  class AM2Wallet extends window.HTMLElement {
    constructor () {
      super()

      this.addEventListener('click', this._onClick)
    }

    get storeId () { return this.getAttribute('store-id') }
    get storeTagName () {
      let store = this
      while (store.parentNode) {
        store = store.parentNode
      }
      store = store.querySelector(`#${this.storeId}`)
      if (store === null) return ''
      return store.tagName.toLowerCase()
    }

    get id () { return this.getAttribute('id') }

    set data (value) { window.localStorage.setItem(`${this.storeTagName}-data-${this.storeId}`, JSON.stringify(value)) }
    get data () {
      if (this.storeTagName !== '') {
        return JSON.parse(window.localStorage.getItem(`${this.storeTagName}-data-${this.storeId}`)).wallets.find((v) => v.alias === this.id)
      } else {
        return { alias: this.id, lastUpdate: new Date(), transactions: [] }
      }
    }

    connectedCallback () {
      const template = document.currentScript.ownerDocument.querySelector('#am2-wallet-template')
      const instance = template.content.cloneNode(true)
      this.appendChild(instance)

      this.querySelector('.am2-wallet-title').innerHTML = `${this.data.alias}: ${this.data.lastUpdate}`
      this.querySelector('.am2-wallet-transactions').innerHTML = JSON.stringify(this.data.transactions)
    }

    disconnectedCallback () {
      this.removeEventListener('click', this._onClick)
    }

    _onClick (event) {
      console.log('onClick', event.target)
    }
  }

  if (!window.customElements.get('am2-wallet')) window.customElements.define('am2-wallet', AM2Wallet)
})()
</script>